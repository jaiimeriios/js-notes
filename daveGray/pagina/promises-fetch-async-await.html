<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="html5 Template" />
    <title>Promises Fetch Async&Await</title>
    <link rel="icon" href="https://raw.githubusercontent.com/jaiimeriios/html5-Main-Template/master/favicon.ico" />
    <link href="../css/normalize.css" rel="stylesheet" media="all" />
    <link href="../css/styles.css" rel="stylesheet" media="all" />
</head>

<body>
    <div class="container">
        <h1>Promises Fetch Async & Await</h1>
    </div>


    <script>
        console.warn("callback hell")
        // Callbacks - callback hell ejemplos
        function firstFunction(param, callback) {
            console.log(param)
            callback()
        }
        function secondFunction(param, callback) {
            console.log(param)
            callback()
        }
        firstFunction("se pasa ala funcion", function () {
            console.log("firstFunction")
            secondFunction("secondFunction", function () {
                console.log("secondFunction llamada desde addentro")

            })
        })

        const makeBurger = (nextStep) => {
            getBeef(function (beef) {
                cookBeef(beef, function (cookedBeef) {
                    getBuns(function (buns) {
                        putBeefBetweenBuns(buns, beef, function (burger) {
                            nextStep(burger);
                        });
                    });
                });
            });
        };

        console.log(makeBurger)


        // PROMESAS
        console.warn("PROMESAS")

        // 3 states: Pending, Fulfilled & Rejected
        const myPromise = new Promise((resolve, reject) => {
            const error = true
            if (!error) {
                resolve("Resolved the Promise")
            } else {
                reject("Neh, Promise rejected")
            }
        })

        myPromise.then((value) => {
            return `value ðŸŒ´`
        })
            .then((newValue) => {
                console.log(newValue)
            })
            .catch((err) => {  // this is what happen if reject
                console.log(`${err} ðŸ”’`)
            })


        const myPromise2 = new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve("Resolved the Promise ðŸŒ²")
            }, 3000);
        })

        myPromise2.then((value) => {
            console.log(value)
        })


        // promises: Pending
        const users = fetch("http://jsonplaceholder.typicode.com/users")
        console.log("en modo pending")
        console.log(users)

        fetch("http://jsonplaceholder.typicode.com/users")
            .then((response) => {
                return response.json()
            })
            .then(data => {
                console.log(data);
            });



        // Async Await
        console.warn("ASYNC AWAIT")

        const URL = "http://jsonplaceholder.typicode.com"

        const infoAPI = async () => {    // async function infoAPI() { } lo mismo
            const response = await fetch(`${URL}/users`)
            const datos = await response.json()
            return datos
        }

        // Ejemplo 1
        const myUsers = {
            userList: []
        }
        const anotherFunc = async () => {

            const anotherData = await infoAPI()

            myUsers.userList = anotherData
            console.log("Aqui si sales", myUsers.userList)
        }
        anotherFunc()
        console.log("esta va primero y no se arma", myUsers.userList)


        // Ejemplo 2
        const getEmails = async () => {
            const datos = await infoAPI()
            const userEmailArray = datos.map((user) => {
                return user.email
            })

            console.log("agarrar correos::", userEmailArray)

            publicarServidor(userEmailArray)
        }

        const publicarServidor = (data) => {
            console.log("Publicar a::", data)
        }

        getEmails()
        publicarServidor()





        // Ejemplo 3 - Segundo Parametro de fetch

        const dadJoke = async () => {
            const respuesta = await fetch("https://icanhazdadjoke.com/", {
                method: "GET",
                headers: {
                    Accept: "application/json"
                }
            })

            const data = await respuesta.json()

            console.log(data)
        }
        dadJoke()




        const dadJokeTexto = async () => {
            const respuesta = await fetch("https://icanhazdadjoke.com/", {
                method: "GET",
                headers: {
                    Accept: "text/plain"
                }
            })

            const data = await respuesta.text()

            console.log("ðŸŒ ", data)
        }
        dadJokeTexto()


        // POST
        const jokeObject = {
            id: "1oOfFlOfaxc",
            joke: "What do you do on a remote island? Try and find the TV island it belongs to."
        }

        const dadJokePost = async (objetoPasado) => {
            const respuesta = await fetch("https://httpbin.org/post", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(objetoPasado)
            })

            const data = await respuesta.json()

            console.log("ðŸŽ‡ðŸŽ‡",data.headers)
        }
        dadJokePost(jokeObject)






        const requestJoke = async (first, last) => {
            const respuesta = await fetch(`https://api.icndb.com/jokes/random?firstName=${first}&lastName=${last}&limitTo=[nerdy]`)
            const data = await respuesta.json()
            console.log("ðŸ’ŽðŸ’Ž", data.value)
        }
        requestJoke("emiaj", "soir")




        // from a form
        const getDataFromForm = () => {
            const requestObject = {
                firstNmae: "Bruce",
                lastName: "Lee",
                categories: ["nerdy"]
            }
            return requestObject
        }

        const buildRequestUrl = (requestData) => {
            return `https://api.icndb.com/jokes/random?firstName=${requestData.firstNmae}&lastName=${requestData.lastName}&limitTo=${requestData.categories}`
        }

        const chiste = async (url) => {
            const respuesta = await fetch(url)
            const data = await respuesta.json()
            const chistesillo = data.value.joke
            postChisteToPage(chistesillo)
        }

        const postChisteToPage = (joke) => {
            console.log("chiste::", joke)
        }


        // Procedural "Workflow" function
        const requestChisteRequest = async () => {
            const requestData = getDataFromForm()
            const requestURL = buildRequestUrl(requestData)
            await chiste(requestURL)
            console.log("chiste reqresado")
        }

        requestChisteRequest()



    </script>
</body>

</html>